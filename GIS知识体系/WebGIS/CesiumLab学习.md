# CesiumLab手册

CesiumLab是一个基础地理信息数据处理的工具集，包括地形、地图的切片，手工模型、点云、BIM、倾斜摄影数据转为3dtiles，以及各种数据的服务发布

## 数据处理基础和处理流程

### 输出的切片格式

1. 影像切片：png或jpg格式，经纬度切片和web墨卡托切片
2. 地形切片：terrain格式，参考Cesium官方文档
3. 模型切片：3dtiles格式：
   1. 索引：json格式的元数据定义，包含数据范围、几何误差等，可嵌套使用
   2. 内容：
      - b3dm：多种三维模型格式，带纹理的地形数据，包含内外结构的三维建筑、大范围模型数据等
      - i3dm：实例化三维模型
      - pnts：海量点数据
      - cmpt：上面三种的组合格式

### 传统GIS数据

1. 栅格数据：dem或者tif格式，可表示高程和影像，其他格式可以用arcgis转换
2. 矢量数据：
   - 栅格化，通过WMTS、WMS加载
   - 矢量化展示，geojson、kml、czml
   - 模型化，根据高度拉白模

### 人工模型

建模工具及原始格式：

- maya，ma/mb格式
- 3dMax，max格式
- Sketchup，skp格式
- Blender，blender格式

数据格式：

- 交换格式：fbx(推荐)、obj(古老)、dae(曾经的标准)
- 渲染格式：gltf,组织结构相对简单

### BIM模型

BIM模型和手工模型的区别：

- 手工模型看不见的东西能省则省，BIM是**按照工程标准创建**
- 手工模型没有属性信息，**BIM有大量属性信息**

数据格式：

- clm：cesiumLab自定义格式，包含几何体、材质纹理、属性信息、模型结构等等
- ifc：BIM标准格式

### 倾斜实景三维数据

contextcapture、smart3d、大疆等等，都支持OSGB格式

### 点云数据

数据格式有las(推荐),xyz,csv等等

## 通用功能

### 空间参考

1. 输出数据3dtiles：地心坐标系的相对坐标，需要乘以变换矩阵
2. 投影和坐标系统识别方案：
   1. EPSG：{code}
      - EPSG：4549：CGCS2000/3-degree Gauss-Kruger CM 120E
      - EPSG：4326：WGS84椭球定义的官方编码
      - EPSG：3857：WEB墨卡托
      - EPSG：4490：我国的椭球定义标准CGCS2000
      - EPSG：4546等等都基于EPSG：4490定义
   2. WKT字符串，例如工程需要自定义中央经线
   3. Proj4字符串
   4. 站心坐标系ENU（east north up）

### 数据存储

#### 散列存储

每个切片是一个单独文件，数据量大了之后，碎片文件较多，硬盘读取效率低

#### PAK地形影像紧凑存储

PAK是自定义的一种用来存储常规瓦片的文件格式，本身是一个sqlite文件(SQLite是一个轻量级数据库管理系统)

- info表:记录数据图层的基础信息，仅有一个
- block系列表：存储切片数据，不止一个

#### CLT瓦片紧凑存储

除了地形和影像，其他工具输出的都是clt格式的紧凑，优势是对于大量散列切片能够加速存储和迁移

- infos表：存储了数据元信息
- tiles表：切片数据

#### Mongodb瓦片存储

#### Postgresql瓦片存储

## 数据处理过程

## 分发服务