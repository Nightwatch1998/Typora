## 模型、视图、投影矩阵

各种矩阵用途：

- 模型矩阵：获取原始模型数据，并在3D世界空间移动。
- 投影矩阵：将世界空间坐标转换为裁剪空间坐标。模拟相机的效果。
- 视图矩阵：负责移动场景中的对象以模拟相机位置的变化。改变观察者当前能够看到的内容。

### 裁剪空间

这是一个中心点位于 (0, 0, 0)，角落范围在 (-1, -1, -1) 到 (1, 1, 1) 之间，2 个单位宽的立方体。该剪裁空间被压缩到一个二维空间并栅格化为图像（可以理解为投影）。

顶点着色器将点转换到裁剪空间的特殊坐标系上。

裁剪空间内的坐标为归一化坐标。只有裁剪空间内的元素才会被渲染。

裁剪空间中z+远离观察者

<img src="https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_model_view_projection/clip_space_graph.svg" alt="A 3d graph showing clip space in WebGL." style="zoom: 25%;" />

### 齐次坐标

(x,y,z)增加第四个坐标(x,y,z,w)变为齐次坐标，w作为其他分量的除数。将透视的概念引入坐标系，允许两条平行线在延伸到远方时相交。

### 模型转换

将模型数据和其他坐标转换到裁剪空间。

例如立方体表面颜色和构成单个多边形的顶点位置顺序组成。这些位置和颜色存储在GL缓冲区，分发到着色器分别进行操作。

计算单个模型矩阵。该矩阵表示要在组成模型的每个点上执行转换。

### 除以W

获取立方体模型透视的简单方法，将Z坐标复制到W上，w可以描述透视

### 简单投影

```
// 单位阵
var identity = [
  1, 0, 0, 0,
  0, 1, 0, 0,
  0, 0, 1, 0,
  0, 0, 0, 1,
];

MDN.multiplyPoint(identity, [2, 3, 4, 1]);
//> [2, 3, 4, 1]

// 移动一格
var copyZ = [
  1, 0, 0, 0,
  0, 1, 0, 0,
  0, 0, 1, 1,
  0, 0, 0, 0,
];

MDN.multiplyPoint(copyZ, [2, 3, 4, 1]);
//> [2, 3, 4, 4]

// 缩放因子
var scaleFactor = 0.5;

var simpleProjection = [
  1, 0, 0, 0,
  0, 1, 0, 0,
  0, 0, 1, scaleFactor,
  0, 0, 0, scaleFactor,
];

MDN.multiplyPoint(simpleProjection, [2, 3, 4, 1]);
//> [2, 3, 4, 2.5]
```

通过scaleFactor，可以控制投影的远近程度：

```GLSL
// 确保以相反的顺序读取转换矩阵
gl_Position = projection * model * vec4(position, 1.0);
```

### 透视矩阵（推导下）

是由数学公式推导出来的

```GLSL
MDN.perspectiveMatrix = function(fieldOfViewInRadians, aspectRatio, near, far) {

  var f = 1.0 / Math.tan(fieldOfViewInRadians / 2);
  var rangeInv = 1 / (near - far);

  return [
    f / aspectRatio, 0,                          0,   0,
    0,               f,                          0,   0,
    0,               0,    (near + far) * rangeInv,  -1,
    0,               0,  near * far * rangeInv * 2,   0
  ];
}

```



### 视图矩阵

## 核心概念

### 顶点着色器（回看）

功能：

1. 顶点变换：顶点着色器可以对输入的顶点位置进行变换操作，例如平移、旋转、缩放等，从而改变顶点在场景中的位置和姿态。
2. 坐标变换：顶点着色器可以将顶点从三维世界空间转换到二维屏幕空间，通过应用投影矩阵和视图矩阵，实现透视投影或正交投影，并进行裁剪和视口变换。
3. 顶点属性传递：顶点着色器可以将顶点属性数据（如颜色、纹理坐标、法线等）传递给后续的着色器阶段，如片段着色器，以便进行插值和计算。
4. 顶点动画：通过在顶点着色器中更新顶点位置、颜色或其他属性，可以实现顶点动画效果，如形变动画、粒子动画等。
5. 顶点着色：顶点着色器可以对顶点进行颜色处理，例如根据顶点属性、灯光、材质等计算顶点的最终颜色。
6. 着色器间数据传递：顶点着色器可以通过输出变量（varying）将数据传递给片段着色器，以便进行插值和计算，例如在顶点着色器中计算的法线数据可以在片段着色器中使用。

### 片段着色器

顶点着色器处理完图形的顶点后，会被将绘制图形的每个像素点调用一次。用于确定像素的颜色。

指定应用到像素的纹理元素，获取纹理元素的颜色，然后将适当的光照应用于颜色。颜色存储在gl_FragColor中。

### uniform变量

类似于JS的全局变量，用于在顶点着色器和片段着色器中传递数据，例如：

- 变换矩阵
- 光照属性
- 纹理对象
