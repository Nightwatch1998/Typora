## 视频流介绍

### RTSP和RTP

RTSP（Real-Time Stream Protocol）由Real Networks和Netscape共同提出的流媒体协议。

RTSP在1998年提出，RTP在1996年提出。RTSP负责控制流媒体播放、暂停、停止等操作，RTP负责传输媒体数据。

一般传输的是**ts、mp4**格式的流

优势：

- 较好的实时性和可靠性
- 适用于**流媒体服务器、IP摄像头、视频监控系统**等实时传输场景

劣势：

- 需要额外的流媒体服务器和客户端支持，配置和部署相对复杂
- 穿透防火墙和代理存在困难

### RTMP

RTMP（Real Time Message Protocol）由Adobe公司在**2002年**提出的流媒体协议，**未完全公开**。用于解决多路复用和分包的问题。一般传输的是**flv、f4v**格式的流。一般在一个通道上传输命令和数据。

优势：

- 支持实时交互和低延迟
- 适用于需要实时交互和快速响应的应用场景，如**虎牙、斗鱼等传统视频直播平台**

劣势：

- 在移动设备上的支持不如其他协议广泛
- 对防火墙和代理的穿透性较差

### FLV

FLV用http服务器即可实现传统的 流媒体服务器的功能，flv文件体积小，视频质量好。但是要基于flash插件。

可使用**flv.js**将flv视频流数据转码，最终传递给h5的video标签进行播放

### HLS

HLS(Http Live Streaming) 是苹果公司**2009年**提出，的基于HTTP的流媒体网络传输协议。将不同速率的版本切片，信息保存在m3u列表文件中。

优势：

- 实现自适应码率和跨平台播放
- 广泛支持各种终端设备，适用于**移动和苹果设备上在线视频点播、直播等**
- 在不同带宽的网络环境下实现较好的流畅播放效果

劣势：

- 实时性差，延迟高，基本在10s+以上
- 不适用于实时互动场景

### DASH

DASH（Dynamic Adaptive Streaming over HTTP）基于HTTP的动态自适应流媒体传输协议。**在2011年提出**，也是将视频切片，通过HTTP传输，实现自适应码率和跨平台播放。

DASH支持自适应码率、跨平台播放和多种编码格式，广泛用于**流媒体点播、直播和互联网电视等领域。**

### WebRTC

WebRTC（Web Real-Time Communication）由Google**在2011年**提出。基于UDP协议，支持浏览器的点对点传输，适用于**视频通话，视频会议、远程协作**等场景。

### 未来发展方向

基于HTTP的流媒体传输协议，如HLS何DASH

- 平台兼容性
- 自适应码率
- 强大的生态系统
- 支持新的技术和特性

## 视频流数据传输流程

1. 摄像头采集：使用摄像头设备（如USB摄像头、IP摄像头等）采集视频数据。这可以通过操作系统提供的摄像头驱动程序或相关的开发库来实现。
2. 编码和压缩：采集到的原始视频数据可能会非常庞大，需要进行编码和压缩以减小数据大小。常见的视频编码标准包括H.264、H.265等。你可以使用编码器来将原始视频数据转换为所需的视频编码格式。
3. 流媒体服务器：设置和配置流媒体服务器，如Nginx-RTMP、Wowza Streaming Engine等。确保服务器具备接收和处理视频流的能力，并配置相应的应用程序和流密钥。
4. 推流：使用推流软件（如OBS）将编码后的视频流推送到流媒体服务器。在推流过程中，需要提供流媒体服务器的地址、应用程序名称和流密钥等信息。
5. 流媒体传输：流媒体服务器接收到推送的视频流后，会根据配置的协议和格式进行传输。常见的流媒体传输协议包括RTMP、HLS、DASH等。服务器会生成相应的流媒体文件（如.ts文件、.m3u8文件等）并提供访问的URL。
6. 前端播放：在前端页面上使用流媒体播放器（如Video.js、Hls.js、DPlayer等）进行视频流的播放。通过提供流媒体服务器生成的URL，前端播放器能够加载和播放视频流。
7. 播放控制和交互：在前端页面上实现所需的播放控制和交互功能，如播放/暂停、音量控制、全屏等。这可以通过播放器提供的API或自定义的JavaScript代码来实现。

## 在线测试

### 测试工具

potplayer

```
https://potplayer.en.softonic.com/download
```

m3u8测试

```
https://m3u8play.com/
```

### 测试地址

- hls测试

```
// 计时器
http://playertest.longtailvideo.com/adaptive/bipbop/gear4/prog_index.m3u8
https://assets.afcdn.com/video49/20210722/v_645516.m3u8

```

- rtsp

```

```

- rtmp

```
// 伊拉克 电视台
rtmp://ns8.indexforce.com/home/mystream
// 韩国GOOD TV
rtmp://mobliestream.c3tv.com:554/live/goodtv.sdp
```

- flv

```
// 西瓜视频测试
https://sf1-hscdn-tos.pstatp.com/obj/media-fe/xgplayer_doc_video/flv/xgplayer-demo-360p.flv
```

- mp4

```
http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4
http://vjs.zencdn.net/v/oceans.mp4
https://media.w3.org/2010/05/sintel/trailer.mp4
```



## 播放与解决方案

### HLS与RTMP播放解决方案

#### 使用原生video

```html
<video width="640" height="320" controls>
    <source src="http://10.10.5.119/live/livestream.m3u8" 		    type="application/x-mpegURL">
</video>

```

- 支持主要媒体格式mp4、ogg、webm、m3u8
- m3u8在pc浏览器支持性较差
- 无法播放rtmp流的视频，原生不支持flv

#### 使用flv.js

```js
import React, { PureComponent } from 'react';
import Reflv from 'reflv';

export class HttpFlv extends PureComponent {
  render() {
    return (
      <Reflv
        url={`http://localhost:7001/live/test.flv`}
        type="flv"
        isLive
        cors
      />
    )
  }
}
```

优点：

- 支持录播和直播
- 去掉对flash的依赖

缺点：

- 依赖Media Source Extensions，只适用于pc端

#### video.js

支持网页在所有浏览器播放，使用react开发

Type：

- 播放rtmp 是rtmp/flv
- 播放hls是application/x-mpegURL

缺点：

- 依赖flash
- 不支持rtsp流

使用：

```html
// video标签嵌入 
// data-setup的配置
<video id="vid1" class="video-js" data-setup='{}'>
  <source src="//vjs.zencdn.net/v/oceans.mp4">
</video>

// 代码配置
<video id="vid1" class="video-js">
  <source src="//vjs.zencdn.net/v/oceans.mp4">
</video>
const player = videojs('vid1', {});

// div包裹嵌入----推荐方式
<div data-vjs-player>
  <video id="vid1" class="video-js" data-setup='{}'>
    <source src="//vjs.zencdn.net/v/oceans.mp4">
  </video>
</div>

// video-js标签
<video-js id="vid1" data-setup='{}'>
  <source src="//vjs.zencdn.net/v/oceans.mp4">
</video-js>
```



### RTSP播放解决方案

#### 利用VLC插件转流

浏览器安装VLC插件进行服务器转码映射，得到ogg格式然后播放

优点：可以直接播放RTSP，无需任何中介服务器帮助

缺点：手动安装插件，基于NPAPI，不被最新的Chrome和Firefox支持，适合兼容IE的项目

#### html5+ websocket_rtsp_proxy 实现视频流直播

实现步骤：

- 服务端安装streamedian服务器

- 客户端通过video标签播放

缺点：

- 收费

#### ffmpeg + nginx + video，rtsp转rtmp播放

使用nginx的rtmp插件

实现步骤：

1. 安装ffmpeg工具
2. 安装nginx
3. 更改nginx配置
4. ffmpeg转码
5. video播放

#### ffmpeg + video，rtsp转hls播放

#### jsmpeg+ffmpeg

jsmpeg是js编写的视频播放器

#### rtsp转WebRTC流