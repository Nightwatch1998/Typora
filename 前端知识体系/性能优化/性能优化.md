## 性能指标

三大核心指标：

- LCP：页面速度指标
- FID：交互体验指标
- CLS：页面稳定指标

### FP&FCP

FP (First Paint) 首次绘制，记录页面第一次绘制像素的时间

FCP(First Contentful Paint) **首次内容绘制**，记录页面首次绘制文本、图片、非空白Canvas或SVG的时间

FP<=FCP

### LCP

Largest Contentful Paint,最大内容绘制，用于记录视窗内**最大的元素**绘制的时间，会随着页面渲染变化而变化，会在用户第一次交互后停止记录

### TTI

Time to Interactive**首次可交互时间**

- 从FCP后开始计算
- 持续秒内无长任务，且无两个以上进行中的GET请求
- 往前回溯至5秒前的最后一个长任务结束的时间

### FID

First Input Delay，首次输入延迟，用户首次与页面交互到浏览器实际响应该事件的时间

用户交互事件触发到页面响应中间耗时多少，推荐100ms以内

### TBT

Total Blocking Time，阻塞总时间。记录FCP到TTI之间所有长任务的阻塞时间总和

长任务(执行时间大于50ms)

每个长任务的阻塞时间=**执行时间-50ms**

### CLS

Cumulative Layout Shift ，累计位移偏移，记录了页面上非预期的位移波动

页面渲染过程中突然插入巨大的图片等等

计算方式：**位移影响的面积*位移距离**，用屏幕面积百分比表示

推荐值低于0.1

## 获取指标工具

- lighthouse
- web-vitals-extension Chrome插件
- Chrome Devtools的Performance选项卡

## 页面的渲染过程

输入网址、解析URL、检查浏览器缓存、DNS解析、TCP/IP解析、HTTP请求、服务器请求并返回http报文、浏览器渲染页面、断开连接

### 输入网址

用户输入查询关键词时，地址栏会判断输入的是**关键字是搜索内容还是URL**

- 如果是搜索内容，会合成带搜索关键字的URL
- 如果符合URL，会添加协议合称为完整的URL

### 解析URL

协议、主机、端口、路径、查询参数、锚点

### DNS解析

获取目标网页IP地址的过程

1. 先递归查询DNS缓存
2. 查询根域名服务器
3. 查询com顶级域名服务器
4. 查询google.com域名服务器
5. 查询结果缓存

优化：

- DNS预解析：有多个不同的服务器资源时，可提前解析，避免卡顿
- DNS负载均衡：把访问引导到不同的服务器上

### TCP/IP连接

三次握手的过程

### 检查浏览器缓存(补充)

网络进程会查找本地缓存是否缓存了该资源，如果有，直接返回给浏览器进程。

浏览器缓存：

- 浏览器发送请求，会根据请求头expires和**cache-control**判断是否命中**强缓存策略**
- 未命中，会发送请求，根据**If-Modified-Since**和If-None-Match判断是否命中**协商缓存**
- 离线缓存，service worker

第三方库公共模块抽取：

- 设置较长的强缓存时间

### HTTP请求(重点看)

建立连接之后，浏览器会构建请求行、请求头等信息，并把cookie数据附加到请求头，然后发送请求。

开启HTTP2：

- HTTP1用文本，HTTP2用二进制分帧通信
- HTTP2可以多路复用，HTTP1会有并发限制
- HTTP2可以头部压缩，节省消息头占用的网络流量
- HTTP2可以服务端推送

### 服务器请求并返回http报文

## 浏览器渲染页面

### DOM树

### CSS对象模型

### 布局树Layout Tree

### 渲染

### 创建图层

### 回流和重绘

## 性能优化(雅虎军规)

